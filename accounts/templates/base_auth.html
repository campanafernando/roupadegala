{% load static %}
<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">

  <title>{% block title %}Roupa de Gala{% endblock title %}</title>
  <link rel="icon" href="{% static 'roupadegalalogo.png' %}">

  <!-- CORE CSS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
  <link href="{% static 'coreui/coreui.css' %}" rel="stylesheet">
  {% block extra_head %}{% endblock extra_head %}

  <style>
    /*––––– Theme variables –––––*/
    :root {
      --sidebar-bg: #31363F;
      --sidebar-color: #e0e0e0;
      --sidebar-hover: #444;
      --main-bg: #f3f3f3;
      --text-color: #323232;
      --toggle-bg: #121212;
      --toggle-color: #fff;
    }
    body.dark-mode {
      --sidebar-bg: #222;
      --sidebar-color: #ccc;
      --sidebar-hover: #333;
      --main-bg: #181818;
      --text-color: #ddd;
      --toggle-bg: #fff;
      --toggle-color: #000;
    }

    /*––––– Layout –––––*/
    body { display: flex; min-height: 100vh; margin: 0; color: var(--text-color); background: var(--main-bg); }
    aside.sidebar {
      width: 250px; background: var(--sidebar-bg); color: var(--sidebar-color);
      display: flex; flex-direction: column; justify-content: space-between;
      transition: width .3s ease;
      overflow: hidden;
    }
    aside.sidebar.collapsed { width: 80px; }

    main.main-content {
      flex: 1; display: flex; flex-direction: column;
    }

    /*––––– Sidebar header –––––*/
    .sidebar-header { text-align: center; padding: 1rem 0; }
    .sidebar-logo {
      max-width: 100px; width: 100%; height: auto;
      display: block; margin: 0 auto .75rem;
      transition: opacity .3s;
    }
    /* hide logo when collapsed */
    aside.sidebar.collapsed .sidebar-logo { opacity: 0; visibility: hidden; }

    .sidebar-avatar {
      width: 50px; height: 50px; border-radius: 50%;
      border: 2px solid var(--sidebar-color);
      display: block; margin: 0 auto;
      transition: opacity .3s;
    }

    /*––––– Nav –––––*/
    .sidebar-nav ul { list-style: none; padding: 0; margin: 0; }
    .sidebar-nav li + li { margin-top: .5rem; }
    .sidebar-nav a {
      display: flex; align-items: center; padding: .75rem 1rem;
      color: inherit; text-decoration: none; border-radius: .25rem;
      transition: background .2s;
    }
    .sidebar-nav a:hover { background: var(--sidebar-hover); }
    .sidebar-nav i { font-size: 1.25rem; margin-right: 1rem; }
    aside.sidebar.collapsed .sidebar-nav span { display: none; }

    /*––––– Footer (logout) –––––*/
    .sidebar-footer { padding: 1rem; text-align: center; }
    .sidebar-footer a { color: inherit; text-decoration: none; display: inline-flex; align-items: center; }
    .sidebar-footer i { font-size: 1.25rem; margin-right: .5rem; }
    aside.sidebar.collapsed .sidebar-footer span { display: none; }

    /*––––– Header –––––*/
    header.site-header {
      display: flex; align-items: center; justify-content: space-between;
      padding: .5rem 1rem; background: var(--main-bg); border-bottom: 1px solid #ccc;
    }
    #sidebarToggle, #darkModeToggle {
      background: var(--toggle-bg); color: var(--toggle-color);
      border: none; font-size: 1.25rem; padding: .5rem; border-radius: 50%;
      cursor: pointer; transition: background .2s;
    }
    #sidebarToggle:hover, #darkModeToggle:hover { opacity: .8; }

    /*––––– Content –––––*/
    .content-wrapper { padding: 1.5rem; flex: 1; overflow-y: auto; }

    /*––––– Notifications badge –––––*/
    .notifications { position: relative; }
    .notifications .badge {
      position: absolute; top: -5px; right: -5px;
      background: red; color: white; border-radius: 50%;
      padding: 2px 5px; font-size: .75rem;
    }
  </style>
</head>

<body>
  <aside class="sidebar" id="sidebar">
    <div>
      <div class="sidebar-header">
        <img src="{% static 'roupadegalalogo.png' %}" alt="Logo" class="sidebar-logo">
        <img src="{% static 'redimensionadaterno.png' %}" alt="{{ user.username }}" class="sidebar-avatar">
      </div>
      <nav class="sidebar-nav">
        <ul>
          <li><a href="{% url 'pre_register'%}"><i class="bi bi-house-add-fill"></i><span>Início</span></a></li>
          <li><a href="{% url 'os_view' %}"><i class="bi bi-card-checklist"></i><span>Ordens de Serviço</span></a></li>
          <li><a href="#"><i class="bi bi-people"></i><span>Clientes</span></a></li>
          <li><a href="{% url 'employee_redirect' %}"><i class="bi bi-person-badge"></i><span>Funcionários</span></a></li>
          <li><a href="{% url 'product_dashboard'%}"><i class="bi bi-box-seam"></i><span>Estoque</span></a></li>
          {% comment %} <li><a href="#"><i class="bi bi-file-earmark-text"></i><span>Fiscal</span></a></li> {% endcomment %}
          <li><a href="#"><i class="bi bi-cash-stack"></i><span>Financeiro</span></a></li>
          <li><a href="#"><i class="bi bi-bar-chart"></i><span>Estatísticas</span></a></li>
        </ul>
      </nav>
    </div>
    <div class="sidebar-footer">
      <a href="{% url 'logout' %}"><i class="bi bi-power"></i><span>Logout</span></a>
    </div>
  </aside>

  <main class="main-content">
    <header class="site-header">
      <button id="sidebarToggle"><i class="bx bx-menu"></i></button>
      <div class="d-flex align-items-center">
        {% if notifications_not_read.qtd %}
          <button class="btn notifications me-2" data-bs-toggle="modal" data-bs-target="#notificationsModal">
            <i class="bi bi-bell"></i>
            <span class="badge">{{ notifications_not_read.qtd }}</span>
          </button>
        {% endif %}
        {% comment %} <button id="darkModeToggle"><i class="bx bx-moon"></i></button> {% endcomment %}
      </div>
    </header>

    <section class="content-wrapper">
      {% block content %}{% endblock content %}
    </section>
  </main>

  <!-- Notifications Modal -->
  <div class="modal fade" id="notificationsModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Notificações{% if notifications_not_read.qtd %} ({{ notifications_not_read.qtd }}){% endif %}</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          {% if notifications %}
            {% for n in notifications %}
              <div class="d-flex mb-3">
                {% if not n.lido_em %}<span class="me-2 text-danger">●</span>{% endif %}
                <div>
                  <small class="text-muted">{{ n.criado_em }}</small>
                  <p class="mb-1"><strong>{{ n.assunto|safe }}</strong></p>
                  <p class="mb-0">{{ n.texto|safe }}</p>
                </div>
              </div>
            {% endfor %}
          {% else %}
            <p class="text-center text-muted mb-0">Sem notificações.</p>
          {% endif %}
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
        </div>
      </div>
    </div>
  </div>

  <!-- CORE SCRIPTS -->
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@coreui/coreui-pro@5.4.2/dist/js/coreui.min.js"></script>
  <script src="https://unpkg.com/htmx.org@1.9.2"></script>
  <script src="https://cdn.jsdelivr.net/npm/ag-grid-charts-enterprise@32.1.0/dist/ag-grid-charts-enterprise.js"></script>
  <script src="{% static 'js/aggrid-utils.js' %}"></script>
  {% block extra_scripts %}{% endblock extra_scripts %}

  <script>
    // Sidebar collapse
    const sidebar = document.getElementById('sidebar');
    document.getElementById('sidebarToggle').onclick = () => {
      sidebar.classList.toggle('collapsed');
      localStorage.setItem('sidebarCollapsed', sidebar.classList.contains('collapsed'));
    };
    if (localStorage.getItem('sidebarCollapsed') === 'true') {
      sidebar.classList.add('collapsed');
    }
{% comment %}
    // Dark mode toggle
    const bodyEl = document.body;
    const dmToggle = document.getElementById('darkModeToggle');
    dmToggle.onclick = () => {
      bodyEl.classList.toggle('dark-mode');
      const active = bodyEl.classList.contains('dark-mode');
      localStorage.setItem('darkMode', active ? 'enabled' : 'disabled');
      dmToggle.innerHTML = active ? '<i class="bx bx-sun"></i>' : '<i class="bx bx-moon"></i>';
    };
    if (localStorage.getItem('darkMode') === 'enabled') {
      bodyEl.classList.add('dark-mode');
      dmToggle.innerHTML = '<i class="bx bx-sun"></i>';
    } {% endcomment %}
  </script>
</body>
</html>
